<html>

<head>

<style>

body {
  background-color: #111;
  color: #FFF;
}


</style>

</head>

<body>

<div id="session_hashtag"></div>

<form>
<input id="upload_file" name="upload_file[]" type="file" onchange="uploadFiles(this.files)" multiple required />
</form>

<br/>
<h2>Log</h2>
<div class="log"></div>

<br/>
<div id="filebuffer"></div>



<script language="javascript" src="jquery-1.12.0.min.js"></script>
<script language="javascript" src="tus.min.js"></script>

<script>

$(document).ready(function (){
   
  
  
});

function uploadFiles(files) {

  //alert(JSON.stringify(files));
  for (var i = 0; i < files.length; i++) {
    
    // create a new tus upload
    var upload = new tus.Upload(files[i], {
      // TODO: insert http Tor address for destination node here
      // For this, the server side must publish its node upload address
      // we can then import it as a value here
      // packet: nodeid-ff00-0002-checksum
      endpoint: 'http://localhost:1080/files/',
      retryDelays: [0, 1000, 3000, 5000],
      onError: function(error) {
        console.log('Failed because: ' + error)
      },
      onProgress: function(bytesUploaded, bytesTotal) {
        var percentage = (bytesUploaded / bytesTotal * 100).toFixed(2)
        console.log(bytesUploaded, bytesTotal, percentage + '%')
      },
      onSuccess: function() {
        console.log('Download %s from %s', upload.file.name, upload.url)
      }
    })

    // Start the upload
    upload.start()
    
  }

}

function log(str) {
  var p = document.createElement('p');
  p.innerHTML = str;
  document.querySelector('.log').appendChild(p);
}

</script>

</body>

</html>
